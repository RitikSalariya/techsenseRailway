{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

    {# MAIN GRID #}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-16">
      {# LEFT: IMAGES #}
      <div>
        {# MAIN IMAGE #}
        <div
          class="relative h-96 rounded-2xl overflow-hidden bg-gradient-to-br from-[#38BDF8]/10 to-[#4F46E5]/10 mb-4 cursor-zoom-in">
          {% if project.thumbnail %}
          <img src="{{ project.thumbnail.url }}" alt="{{ project.title }}"
               class="w-full h-full object-cover js-zoom-image"
               data-src="{{ project.thumbnail.url }}">
          {% endif %}
        </div>

        {# THUMBNAILS: main + extra images #}
        {% if project.thumbnail or extra_images %}
        <div class="grid grid-cols-4 gap-4">
          {% if project.thumbnail %}
          <button class="h-24 rounded-xl overflow-hidden border-2 border-[#38BDF8] ring-2 ring-[#38BDF8]/30">
            <img src="{{ project.thumbnail.url }}"
                 alt="{{ project.title }}"
                 class="w-full h-full object-cover js-zoom-image"
                 data-src="{{ project.thumbnail.url }}">
          </button>
          {% endif %}

          {% for img in extra_images %}
          <button
            class="h-24 rounded-xl overflow-hidden border-2 border-white/20 hover:border-[#38BDF8]/50 transition-all">
            <img src="{{ img.image.url }}"
                 alt="{{ img.caption|default:project.title }}"
                 class="w-full h-full object-cover js-zoom-image"
                 data-src="{{ img.image.url }}">
          </button>
          {% endfor %}
        </div>
        {% endif %}
      </div>

      {# RIGHT: DETAILS #}
      <div>
        <div class="sticky top-24 space-y-6">
          <span class="inline-block px-3 py-1 bg-gradient-to-r from-[#38BDF8] to-[#4F46E5] text-white text-xs rounded-full">
            {{ project.category|capfirst }}
          </span>

          <h1 class="text-3xl font-semibold text-[#0F172A]">
            {{ project.title }}
          </h1>

          <p class="text-[#0F172A]/70">
            {{ project.description|linebreaks }}
          </p>

          {# PRICE & CTA #}
          <div class="bg-white/60 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
            <span class="text-[#0F172A]/60 text-sm">Price</span>
            <p class="text-2xl font-semibold text-[#4F46E5] mb-4">
              ₹{{ project.price }}
            </p>

            <div class="flex gap-3">
              <a href="{% url 'store:buy_project' project.slug %}"
                 class="flex-1 inline-flex items-center justify-center px-4 py-3 rounded-full bg-[#4F46E5] text-white text-sm font-semibold hover:bg-[#4338CA] transition">
                Buy Now
              </a>

              <a href="{% url 'store:add_to_cart' project.slug %}"
                 class="inline-flex items-center justify-center px-4 py-3 rounded-full border border-[#CBD5F5] text-sm font-semibold text-[#0F172A] bg-white hover:bg-[#F9FAFB]">
                Add to Cart
              </a>
            </div>
          </div>

          {# QUICK INFO (you can adjust based on your model fields) #}
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-white/20">
              <p class="text-[#0F172A]/60 text-sm">Duration</p>
              <p class="text-[#0F172A] font-medium">
                {{ project.duration|default:"4 weeks" }}
              </p>
            </div>
            <div class="bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-white/20">
              <p class="text-[#0F172A]/60 text-sm">Level</p>
              <p class="text-[#0F172A] font-medium">
                {{ project.level|capfirst }}
              </p>
            </div>
          </div>

          {# TECH STACK #}
          <div class="bg-white/60 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
            <h3 class="text-[#0F172A] mb-3 font-semibold">Tech Stack</h3>
            <p class="text-sm text-[#0F172A]/80">
              {{ project.tech_stack }}
            </p>
          </div>
        </div>
      </div>
    </div>

    {# IMAGE ZOOM MODAL #}
    <div id="imageModal"
         class="fixed inset-0 z-50 bg-black/90 hidden items-center justify-center p-4">
      <button
        id="closeImageModal"
        class="absolute top-4 right-4 p-2 bg-white rounded-full hover:bg-gray-100 transition">
        ✕
      </button>
      <img id="modalImage"
           src=""
           alt="Zoomed preview"
           class="max-w-full max-h-full object-contain rounded-2xl shadow-2xl border border-white/10">
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const modal = document.getElementById('imageModal');
  const modalImg = document.getElementById('modalImage');
  const closeBtn = document.getElementById('closeImageModal');

  function openModal(src) {
    modalImg.src = src;
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeModal() {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  document.querySelectorAll('.js-zoom-image').forEach(img => {
    img.addEventListener('click', (e) => {
      e.preventDefault();
      const src = img.getAttribute('data-src') || img.src;
      openModal(src);
    });
  });

  closeBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    closeModal();
  });

  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeModal();
    }
  });
});
</script>

{% endblock %}
